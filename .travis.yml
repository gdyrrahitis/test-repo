dist: trusty
sudo: required
language: csharp
mono: none
dotnet: "2.0.0"
solution: test-repo.sln
env: 
  - SH=bash
  - PACKAGE_VERSION="1.0.0"
script: 
  - curl -L -o nuget.exe https://dist.nuget.org/win-x86-commandline/latest/nuget.exe
  - "dotnet restore"
  - "dotnet build -c Release --no-restore"
deploy:
  provider: script
  script:
  - mono nuget pack ./test-repo.nuspec -Verbosity detailed -Version 1.0.0
  - mono nuget push ./test-repo.*.nupkg -Verbosity detailed -ApiKey=$NUGET_SOURCE -Source=$PACKAGE_VERSION
  skip_cleanup: true
  on: 
    branch: master
after_deploy: 
  - "git config --global user.email \"builds@travis-ci.com\""
  - "git config --global user.name \"Travis CI\""
  - "export GIT_TAG=$PACKAGE_VERSION"
  - "git tag $GIT_TAG -a -m \"Generated tag $GIT_TAG from TravisCI build $TRAVIS_BUILD_NUMBER\""
  - "git push --quiet https://$GITHUBKEY@github.com/gdyrrahitis/test-repo $GIT_TAG"
